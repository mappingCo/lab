<!DOCTYPE html>
<html>
	<head>
 		<title>Orthodrome animated flight path</title>
  		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  		<link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.1/dist/leaflet.css"
  		integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
  		crossorigin=""/>

		<link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.1/dist/leaflet.css" />
  		<style>
			body {
			    padding: 0;
			    margin: 0;
			}
			html, body, #map {
			    height: 100%;
			}
		</style>
	</head>
	<body>
  		<div id="map"></div>
	</body>
	<script src="https://unpkg.com/leaflet@0.7.1/dist/leaflet.js"
  	integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  	crossorigin=""></script>
	<script src="https://unpkg.com/leaflet@0.7.1/dist/leaflet.js"></script>
	<script src="orthodroma.js"></script>
	<script src="AnimatedMarker.js"></script>

	<script type="text/javascript">

		var InitialCenter = new L.LatLng(41, -72);
		var map = L.map('map');
		map.setView(InitialCenter, 3);

		 var baseLayer = L.tileLayer(
            		'https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}.png', {
            		maxZoom: 11,
			attribution: 'Tiles Courtesy of argisonline'
          	}).addTo(map);
		

	
		// add a new line to the map, but one with no points - yet
		var polyline = L.polyline([],{
			color:'red'
		}).addTo(map);
		// keep a tally of how many points we've added to the map
		var pointsAdded = 0;
		var linea1 =orthodroma2.features[0].geometry.coordinates;
		var pointsTobeAdded= linea1.length

		// start adding new points to the map
		add();
	
		function add() {
	
			// addLatLng takes a new latLng location and puts it at the end of the line
			polyline.addLatLng(
	        	L.latLng(linea1[pointsAdded][1],linea1[pointsAdded][0])
	        );

		    // pan the map along with where the line is being added.
		    map.setView([linea1[pointsAdded][1],linea1[pointsAdded][0]], 3);
				
			
			if (++pointsAdded < pointsTobeAdded) window.setTimeout(add, 100);
		};//end add()
		
		lines= L.geoJson(orthodroma2,{
			onEachFeature:onEachFeature
		});

		var lines, route, coorSalida, coorLlegada;

		var myIcon = L.icon({
		  iconUrl: 'plane.png',
		  iconAnchor:  [20, 24], // point of the icon which will correspond to marker's location
		});
		
		function onEachFeature(feature, layer) {
		
			var array = feature.geometry.coordinates
			var myArray =[];
			var last=array.length-1

			coorSalida = [array[0][1], array[0][0]]
			coorLlegada = [array[last][1], array[last][0]]
			console.log('llegada: '+coorLlegada+' salida: '+coorSalida)
		
			for (var i = 0; i <= array.length-1; i++) {
				console.log([array[i][1], array[i][0]]);
				myArray.push([array[i][1], array[i][0]])
			};
			route = L.polyline(myArray);
			console.log(route)
			
		}

		var salida  = L.marker(coorSalida).addTo(map);
		var llegada = L.marker(coorLlegada).addTo(map);

		var animatedMarker = L.animatedMarker(route.getLatLngs(), {
			icon: myIcon,
		  	distance: 9200,  // meters
		  	interval: 10, // milliseconds
		});

		map.addLayer(animatedMarker);

	</script>
  

</html>
